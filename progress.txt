# Task: Update server/src/routes/vods.ts - Replace cookie-based auth with Supabase JWT Bearer token verification

## Changes Made:

1. **Updated Dependencies** (merged from other agent branches):
   - Updated `server/src/lib/env.ts` to include Supabase environment variables (SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, SUPABASE_ANON_KEY, OPENAI_API_KEY)
   - Created `server/src/lib/supabase.ts` with Supabase client and `verifySupabaseToken()` helper function
   - Updated `server/package.json` to replace AWS S3 SDK with @supabase/supabase-js dependency
   - Ran `bun install` to install all dependencies

2. **Updated Authentication in vods.ts**:
   - Removed cookie-based authentication (`getCookie` import and cookie-based token retrieval)
   - Replaced `requireAuth` middleware to use Bearer token authentication
   - New middleware now:
     * Checks for `Authorization: Bearer <token>` header
     * Verifies the JWT token using `verifySupabaseToken()` from supabase.ts
     * Extracts Twitch access token from Supabase user metadata (`provider_token` or `twitch_access_token`)
     * Stores both user and twitchClient in context for downstream route handlers
     * Returns 401 with descriptive error messages for various auth failure scenarios

3. **Key Implementation Details**:
   - All four VOD routes continue using the same `requireAuth` middleware:
     * GET `/mine` - Get VODs for authenticated user
     * GET `/channel/:login` - Get VODs for any channel
     * GET `/:id` - Get specific VOD details
     * GET `/channel/:login/clips` - Get clips for a channel
   - Routes remain unchanged - only the authentication mechanism was updated
   - Maintains backward compatibility with existing route signatures and response formats

## Authentication Flow:
1. Client sends request with `Authorization: Bearer <supabase-jwt-token>` header
2. Middleware verifies token with Supabase Auth using service role client
3. Extracts Twitch provider token from authenticated user's metadata
4. Creates TwitchClient instance with provider token for API calls
5. Route handlers access TwitchClient as before via `c.get('twitchClient')`

## Notes:
- The implementation assumes Supabase Auth with Twitch OAuth provider
- Twitch access token is expected in user_metadata.provider_token or user_metadata.twitch_access_token
- TypeScript compilation shows minor type warnings related to Hono's context typing (expected and safe)
- All routes maintain existing functionality while using new auth mechanism
